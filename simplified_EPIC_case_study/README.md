# Simplified Electric Power and Intelligent Control (SEPIC) testbed with a Python physical process simulator

## Description
This testbed has been specifically designed to evaluate a Pandapower-based physical process simulator, developed by Daisuke Mashima et al., to provide a useful testbed in an electrical context. The architecture, technologies, and tools of this testbed are inspired by both the HoneyICS honeynet and the cyber range generated by SG-ML. The implemented physical process is a simplified version of the Electric Power and Intelligent Control (EPIC) testbed, this latter developed by a group of iTrust researchers. This simplified version consists of a single electrical substation with three distinct segments: Generation/Microgrid, Transmission, and Loads.

## Physical process
The physical process involves three distinct segments, each with its own specific function:
- The Generation/Microgrid segment is primarily responsible for generating and storing electrical power to meet the load demands. It consists of two diesel generators and a photovoltaic (PV) plant for power generation, while excess power is stored in a battery. Additionally, if the generated and stored power is insufficient to meet the load demands, electrical power can be drawn from the public grid;
- The Transmission segment connects the Generation/Microgrid segment to the Loads segment. Since the voltage of the busbar (bus_bar_1) related to the two generators, PV plant, and battery is already suitable for the loads, no transformer is required. However, a transformer is needed between the busbar (bus_bar_2) related to the public electrical grid and the loads to step down the voltage;
- The Loads segment consists of the entities that consume the generated electrical energy. In this testbed, there are four loads, each with its own criticality and electricity requirements.

The physical process is governed by several IEDs:
- Two IEDs (MIED1 and MIED2) for the Generation/Microgrid segment;
- Three IEDs (TIED1, TIED2 and TIED4) for the Trnsmission segment;
- Four IED (SIED1, SIED2, SIED3 and SIED4) for the Loads segment.

(immagine physical process SEPIC)

## Testbed architecture
This testbed consists of four Docker containers:
- A SCADA HMI container: This container runs an instance of ScadaBR, which implements a SCADA HMI, allowing users to visualize the physical process values (e.g., voltage, current, and electrical power);
- A Virtual PLC container: This container runs a virtual PLC implemented using OpenPLC61850, an enhanced version of OpenPLC that supports IEC61850 protocols. In this testbed, the PLC is used solely to send IED values to the SCADA HMI;
- A IEDs container: This container runs an instance of Mininet to emulate a network of nine virtual hosts, one for each IED in the system, emulating the TCP/IP stack. Each host runs a process named "VIRTUAL_IED" to emulate the behavior of a single IED;
- A Physical process simulator container: This container runs a Python-based physical process simulator that uses the Pandapower library and additional files to simulate and model the physical processes occurring in this electrical system.

(immagine architecture SEPIC)

## Pandapower-based physical process simulator accuracy property evaluation
To evaluate the accuracy property of the Pandapower-based physical process simulator, a typical scenario has been considered. The realization of this scenario is done applying some changes to the extra XML file that contains the support info for the simulator. This modified file is contained inside "/Evaluation_materials/Accuracy". In this scenario, a peak energy demand from Load 4 is simulated, triggering a corresponding increase in production from the generator (Gen_1) and causing a current surge throughout the electrical grid. As a result, all cir-
cuit breakers are opened.  Figure ... illustrates the process managed by IED4 prior to the power peak, displaying the current power demand of Load 4. Instead, Figure ... depicts SIED4 forcing the circuit breaker (line cb 10) to open in response to the current surge.

(figures)

## Pandapower-based physical process simulator interactivity property evaluation
To evaluate the interactivity evaluation of the Pandapower-based physical process simulator, two experiments have done. Each of these experiments is contained inside folder "/Evaluation_materials/Interactivity".

The first experiment involves manipulating the circuit breaker (line cb 10) associated with one load (load 4). Using a Python script ("modify_line_cb_10.py"), we connect to the MySQL server and we execute a query to open the circuit breaker. Figure 5.10 shows the power values recorded by the SIED4 for the load
and by MIED1 for the generator (Gen 1 before the operation, while Figure 5.10 presents the results after the physical process manipulation. As we can see, the power demand of the load dropped to 0, while the power generated by the generator decreased, indicating that the power demand previously required by the load has been removed.

The second experiment involves manipulating the circuit breaker (line cb 4) associated with the transmission segment connecting the generation to the loads. As in the first experiment, a Python script ("modify_line_cb_4.py") was utilized to connect to the MySQL server and execute a query to open the circuit breaker. Figure 5.12 illustrates, through the PLC HMI, the status of all circuit breakers prior to the manipulation, while Figure 5.13 depicts the status following the manipulation, emphasizing the disconnection of all circuit breakers within the load segment.

## Pandapower-based physical process simulator lightweight property evaluation
Figures 5.14 show the CPU and RAM consumption of the Pandapower-based simulator container for the simplified EPIC testbed. It demonstrates that for an electrical network comprising two generators, a photovoltaic system, a battery bank, and four loads, resource consumption are minimal.

## Main file descriptions
- build_system.sh: A Bash script that builds docker images and runs the docker containers of the system (PLC, SCADA HMI, IEDs and Python-based simulator).
- start_system.sh: A Bash script that starts docker containers of the system.
- stop_system.sh: A Bash script that stops docker containers of the system.

## Docker images building and containers running

```bash
  sh ./build_system.sh
```

## Starting the system

```bash
  sh ./starting_system.sh
```

## Stopping the system

```bash
  sh ./stop_system.sh
```

## Important note about OpenPLC61850 instances
- Sometimes it is necessary to recompile the ladder logic from the "Programs" page of OpenPLC61850;
- To visualize the IEDs processes, you need to exec this bash commands on the main host:
```bash
  xhost +local:*
```
- To allow the communication between PLC container and IEDs processes of the Mininet emulated network you must exec this bash command: 
```bash
  sudo route add -net 172.16.0.0/16 docker0
```
