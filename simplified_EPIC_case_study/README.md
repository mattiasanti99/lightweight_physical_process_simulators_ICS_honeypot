# Simplified Electric Power and Intelligent Control (SEPIC) testbed with a Python physical process simulator

## Description
This testbed has been specifically designed to evaluate a Pandapower-based physical process simulator, developed by Daisuke Mashima et al., to provide a useful testbed in an electrical context. The architecture, technologies, and tools of this testbed are inspired by both the HoneyICS honeynet and the cyber range generated by SG-ML. The implemented physical process is a simplified version of the Electric Power and Intelligent Control (EPIC) testbed, this latter developed by a group of iTrust researchers. This simplified version consists of a single electrical substation with three distinct segments: Generation/Microgrid, Transmission, and Loads.

## Physical process
The physical process involves three distinct segments, each with its own specific function:
- The Generation/Microgrid segment is primarily responsible for generating and storing electrical power to meet the load demands. It consists of two diesel generators and a photovoltaic (PV) plant for power generation, while excess power is stored in a battery. Additionally, if the generated and stored power is insufficient to meet the load demands, electrical power can be drawn from the public grid;
- The Transmission segment connects the Generation/Microgrid segment to the Loads segment. Since the voltage of the busbar (bus_bar_1) related to the two generators, PV plant, and battery is already suitable for the loads, no transformer is required. However, a transformer is needed between the busbar (bus_bar_2) related to the public electrical grid and the loads to step down the voltage;
- The Loads segment consists of the entities that consume the generated electrical energy. In this testbed, there are four loads, each with its own criticality and electricity requirements.

The physical process is governed by several IEDs:
- Two IEDs (MIED1 and MIED2) for the Generation/Microgrid segment;
- Three IEDs (TIED1, TIED2 and TIED4) for the Trnsmission segment;
- Four IED (SIED1, SIED2, SIED3 and SIED4) for the Loads segment.

![phy_proc_sepic](/materials/images/SEPIC_SLD.png)
**Figure 1**: Simplified EPIC physical process

## Testbed architecture
This testbed consists of four Docker containers:
- A SCADA HMI container: This container runs an instance of ScadaBR, which implements a SCADA HMI, allowing users to visualize the physical process values (e.g., voltage, current, and electrical power);
- A Virtual PLC container: This container runs a virtual PLC implemented using OpenPLC61850, an enhanced version of OpenPLC that supports IEC61850 protocols. In this testbed, the PLC is used solely to send IED values to the SCADA HMI;
- A IEDs container: This container runs an instance of Mininet to emulate a network of nine virtual hosts, one for each IED in the system, emulating the TCP/IP stack. Each host runs a process named "VIRTUAL_IED" to emulate the behavior of a single IED;
- A Physical process simulator container: This container runs a Python-based physical process simulator that uses the Pandapower library and additional files to simulate and model the physical processes occurring in this electrical system.

![arch_sepic](/materials/images/architecture_SEPIC_testbed_pandapower.png)
**Figure 2**: Simplified EPIC testbed architecture

## Pandapower-based physical process simulator lightweight property evaluation
**Figure 3** show the CPU and RAM consumption of the Pandapower-based simulator container for the simplified EPIC testbed. It demonstrates that for an electrical network comprising two generators, a photovoltaic system, a battery bank, and four loads, resource consumption are minimal.

![res_sepic](/materials/images/sepic_resources.png)
**Figure 3**: SEPIC Pandapower-based physical process simulator consumed resources

## Main file descriptions
- build_system.sh: A Bash script that builds docker images and runs the docker containers of the system (PLC, SCADA HMI, IEDs and Python-based simulator).
- start_system.sh: A Bash script that starts docker containers of the system.
- stop_system.sh: A Bash script that stops docker containers of the system.

## Docker images building and containers running

```bash
  sh ./build_system.sh
```

## Starting the system

```bash
  sh ./starting_system.sh
```

## Stopping the system

```bash
  sh ./stop_system.sh
```

## Important note about OpenPLC61850 instances
- Sometimes it is necessary to recompile the ladder logic from the "Programs" page of OpenPLC61850;
- To visualize the IEDs processes, you need to exec this bash commands on the main host:
```bash
  xhost +local:*
```
- To allow the communication between PLC container and IEDs processes of the Mininet emulated network you must exec this bash command: 
```bash
  sudo route add -net 172.16.0.0/16 docker0
```
